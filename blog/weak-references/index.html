<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Understanding Weak References | ChatbotWS</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://chatbot.qubitpi.org/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://chatbot.qubitpi.org/img/logo.png"><meta data-rh="true" property="og:url" content="https://chatbot.qubitpi.org/blog/weak-references"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Understanding Weak References | ChatbotWS"><meta data-rh="true" name="description" content="[//]: # (Copyright 2025 Jiaqi Liu. All rights reserved.)"><meta data-rh="true" property="og:description" content="[//]: # (Copyright 2025 Jiaqi Liu. All rights reserved.)"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-12-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/QubitPi"><meta data-rh="true" property="article:tag" content="Java"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chatbot.qubitpi.org/blog/weak-references"><link data-rh="true" rel="alternate" href="https://chatbot.qubitpi.org/blog/weak-references" hreflang="en"><link data-rh="true" rel="alternate" href="https://chatbot.qubitpi.org/blog/weak-references" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://9U0KDRI80N-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="ChatbotWS RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="ChatbotWS Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="ChatbotWS" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.8e9c077b.css">
<script src="/assets/js/runtime~main.6a6a3bc8.js" defer="defer"></script>
<script src="/assets/js/main.6ec340ef.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_C00H" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="ChatbotWS Logo" class="themedComponent_aX2O themedComponent--light_JaL3"><img src="/img/logo.svg" alt="ChatbotWS Logo" class="themedComponent_aX2O themedComponent--dark_PJtI"></div><b class="navbar__title text--truncate">ChatbotWS</b></a><a class="navbar__item navbar__link" href="/docs/intro">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://chatbot.qubitpi.org/apidocs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ANth"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/QubitPi/chatbot-ws" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ANth"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_xYhg colorModeToggle_XpEf"><button class="clean-btn toggleButton__BAK toggleButtonDisabled_LpFA" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_IpxZ"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_NKFj"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_rIZm"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_La2C"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_LgOa thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_NHdC margin-bottom--md">Recent posts</div><ul class="sidebarItemList_FzW1 clean-list"><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/restassured-json">(RestAssured) Match JSON Ignoring Order</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/provider">Provider v.s. @Provider</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/bearer-authentication">Bearer Authentication</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/java-optional">Tired of Null Pointer Exceptions? Consider Using Java SE 8&#x27;s &quot;Optional&quot;</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/happy-path">Happy Path</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/defensive-copy">Defensive Copy</a></li><li class="sidebarItem_nTKB"><a aria-current="page" class="sidebarItemLink_sZwG sidebarItemLinkActive_DRd_" href="/blog/weak-references">Understanding Weak References</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/querydsl">Querydsl - A Type-Safe Query Writer for Java</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/java-stream">Java 8 Stream</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/put-vs-post">PUT v.s. POST</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/jpql">JQPL</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/java-ee">What is Java EE</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/mysql-troubleshooting">MySQL Troubleshooting</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/mysql-security">MySQL Security</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/mysql-polymorphism">How to Deal with Polymorphism in MySQL?</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/mysql-programming">Programming MySQL</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/oracle-programming">Programming Oracle Database</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/read-avro-command-line">Reading and Writing Avro Files from the Command Line</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/env-var-in-pom">Refer to Environment Variables in POM</a></li><li class="sidebarItem_nTKB"><a class="sidebarItemLink_sZwG" href="/blog/java-env-properties">Java System Properties &amp; Environment Variables API&#x27;s</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="[//]: # (Copyright 2025 Jiaqi Liu. All rights reserved.)"><header><h1 class="title_lnpi" itemprop="headline">Understanding Weak References</h1><div class="container_QTz4 margin-vert--md"><time datetime="2021-12-30T00:00:00.000Z" itemprop="datePublished">December 30, 2021</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_fC6X"><div class="avatar margin-bottom--sm"><a href="https://github.com/QubitPi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/16126939?v=4" alt="Jack" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/QubitPi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jack</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChatbotWS</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_L1yj" id="strong-references">Strong References<a href="#strong-references" class="hash-link" aria-label="Direct link to Strong References" title="Direct link to Strong References">​</a></h2>
<p>A <strong>strong reference</strong> is an ordinary Java reference, the kind you use every day. For example, the code:</p>
<div class="language-java codeBlockContainer_dsFJ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qwYU"><pre tabindex="0" class="prism-code language-java codeBlock_OAmf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_y6aT"><span class="token-line" style="color:#393A34"><span class="token class-name">StringBuffer</span><span class="token plain"> buffer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">StringBuffer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_WeXH"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_YJer" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_h31_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Vii8"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>creates a new <code>StringBuffer</code> and stores a strong reference to it in the variable <code>buffer</code>. Yes, yes, this is kiddie
stuff, but bear with me. <em>The important part about strong references -- the part that makes them &quot;strong&quot; -- is how they
interact with the garbage collector</em>. Specifically, if an object is reachable via a chain of strong references (strongly
reachable), it is not eligible for garbage collection. As you don&#x27;t want the garbage collector destroying objects you&#x27;re
working on, this is normally exactly what you want.</p>
<h2 class="anchor anchorWithStickyNavbar_L1yj" id="when-strong-references-are-too-strong">When Strong References are Too Strong<a href="#when-strong-references-are-too-strong" class="hash-link" aria-label="Direct link to When Strong References are Too Strong" title="Direct link to When Strong References are Too Strong">​</a></h2>
<p>It&#x27;s not uncommon for an application to use classes that it can&#x27;t reasonably extend. The class might simply be marked
<code>final</code>, or it could be something more complicated, such as an interface returned by a factory method backed by an
unknown (and possibly even unknowable) number of concrete implementations. Suppose you have to use a class <code>Widget</code> and,
for whatever reason, it isn&#x27;t possible or practical to extend <code>Widget</code> to add new functionality.</p>
<p>What happens when you need to keep track of extra information about the object? In this case, suppose we find ourselves
needing to keep track of each Widget&#x27;s serial number, but the Widget class doesn&#x27;t actually have a serial number
property -- and because Widget isn&#x27;t extensible, we can&#x27;t add one. No problem at all, that&#x27;s what <code>HashMaps</code> are for:</p>
<div class="language-java codeBlockContainer_dsFJ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qwYU"><pre tabindex="0" class="prism-code language-java codeBlock_OAmf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_y6aT"><span class="token-line" style="color:#393A34"><span class="token plain">serialNumberMap</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">put</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">widget</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> widgetSerialNumber</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_WeXH"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_YJer" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_h31_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Vii8"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This might look okay on the surface, but the strong reference to widget will almost certainly cause problems. We have to
know (with 100% certainty) when a particular Widget&#x27;s serial number is no longer needed, so we can remove its entry from
the map. Otherwise we&#x27;re going to have a memory leak (if we don&#x27;t remove Widgets when we should) or we&#x27;re going to
inexplicably find ourselves missing serial numbers (if we remove Widgets that we&#x27;re still using). If these problems
sound familiar, they should: they are exactly the problems that users of non-garbage-collected languages face when
trying to manage memory, and we&#x27;re not supposed to have to worry about this in a more civilized language like Java.</p>
<p>Another common problem with strong references is caching, particular with very large structures like images. Suppose you
have an application which has to work with user-supplied images, like the web site design tool I work on. Naturally you
want to cache these images, because loading them from disk is very expensive and you want to avoid the possibility of
having two copies of the (potentially gigantic) image in memory at once. Because an image cache is supposed to prevent
us from reloading images when we don&#x27;t absolutely need to, you will quickly realize that the cache should always contain
a reference to any image which is already in memory. With ordinary strong references, though, that reference itself will
force the image to remain in memory, which requires you (just as above) to somehow determine when the image is no longer
needed in memory and remove it from the cache, so that it becomes eligible for garbage collection. Once again you are
forced to duplicate the behavior of the garbage collector and manually determine whether or not an object should be in
memory.</p>
<h2 class="anchor anchorWithStickyNavbar_L1yj" id="weak-references">Weak References<a href="#weak-references" class="hash-link" aria-label="Direct link to Weak References" title="Direct link to Weak References">​</a></h2>
<p>A <strong>weak reference</strong>, simply put, is a reference that isn&#x27;t strong enough to force an object to remain in memory. Weak
references allow you to leverage the garbage collector&#x27;s ability to determine reachability for you, so you don&#x27;t have to
do it yourself. You create a weak reference like this:</p>
<div class="language-java codeBlockContainer_dsFJ theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qwYU"><pre tabindex="0" class="prism-code language-java codeBlock_OAmf thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_y6aT"><span class="token-line" style="color:#393A34"><span class="token class-name">WeakReference</span><span class="token plain"> weakWidget </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">WeakReference</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">widget</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_WeXH"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_YJer" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_h31_"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Vii8"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>and then elsewhere in the code you can use <code>weakWidget.get()</code> to get the actual Widget object. Of course the weak
reference isn&#x27;t strong enough to prevent garbage collection, so you may find (if there are no strong references to the
widget) that <code>weakWidget.get()</code> suddenly starts returning <code>null</code>.</p>
<p>To solve the &quot;widget serial number&quot; problem above, the easiest thing to do is use the built-in <code>WeakHashMap</code> class.
<code>WeakHashMap</code> works exactly like <code>HashMap</code>, except that the keys (not the values!) are referred to using weak
references. If a <code>WeakHashMap</code> key becomes garbage, its entry is removed automatically. This avoids the pitfalls
described earlier and requires no changes other than the switch from <code>HashMap</code> to a <code>WeakHashMap</code>. If you&#x27;re following
the standard convention of referring to your maps via the Map interface, no other code needs to even be aware of the
change.</p>
<h2 class="anchor anchorWithStickyNavbar_L1yj" id="reference-queues">Reference Queues<a href="#reference-queues" class="hash-link" aria-label="Direct link to Reference Queues" title="Direct link to Reference Queues">​</a></h2>
<p>Once a <code>WeakReference</code> starts returning <code>null</code>, the object it pointed to has become garbage and the <code>WeakReference</code>
object is pretty much useless. This generally means that some sort of cleanup is required; <code>WeakHashMap</code>, for example,
has to remove such defunct entries to avoid holding onto an ever-increasing number of dead <code>WeakReferences</code>.</p>
<p>The <code>ReferenceQueue</code> class makes it easy to keep track of dead references. If you pass a <code>ReferenceQueue</code> into a weak
reference&#x27;s constructor, the reference object will be automatically inserted into the reference queue when the object to
which it pointed becomes garbage. You can then, at some regular interval, process the <code>ReferenceQueue</code> and perform
whatever cleanup is needed for dead references.</p>
<h2 class="anchor anchorWithStickyNavbar_L1yj" id="different-degrees-of-weakness">Different Degrees of Weakness<a href="#different-degrees-of-weakness" class="hash-link" aria-label="Direct link to Different Degrees of Weakness" title="Direct link to Different Degrees of Weakness">​</a></h2>
<p>Up to this point I&#x27;ve just been referring to &quot;weak references&quot;, but there are actually <strong>4 degrees of reference
strength</strong> (in order from strongest to weakest):</p>
<ol>
<li>strong</li>
<li>soft</li>
<li>weak</li>
<li>phantom</li>
</ol>
<p>We&#x27;ve already discussed strong and weak references, so let&#x27;s take a look at the other two.</p>
<h2 class="anchor anchorWithStickyNavbar_L1yj" id="soft-references">Soft References<a href="#soft-references" class="hash-link" aria-label="Direct link to Soft References" title="Direct link to Soft References">​</a></h2>
<p>A <strong>soft reference</strong> is exactly like a weak reference, except that it is less eager to throw away the object to which it
refers. An object which is only weakly reachable will be discarded at the next garbage collection cycle, but an object
which is softly reachable will generally stick around for a while.</p>
<p>Soft references aren&#x27;t required to behave any differently than weak references, but in practice softly reachable objects
are generally retained as long as memory is in plentiful supply. <strong>This makes them an excellent foundation for a
cache</strong>, such as the image cache described above, since you can let the garbage collector worry about both how reachable
the objects are and how badly it needs the memory they are consuming.</p>
<h2 class="anchor anchorWithStickyNavbar_L1yj" id="phantom-references">Phantom References<a href="#phantom-references" class="hash-link" aria-label="Direct link to Phantom References" title="Direct link to Phantom References">​</a></h2>
<p>A <strong>phantom reference</strong> is quite different than either soft reference or weak reference. Its grip on its object is so
tenuous that you can&#x27;t even retrieve the object - its <code>get()</code> method always returns <code>null</code>. <strong>The only use for such a
reference is keeping track of when it gets enqueued into a <code>ReferenceQueue</code>, as at that point you know the object to
which it pointed is dead</strong>. How is that different from weak reference, though?</p>
<p>The difference is in exactly when the enqueuing happens. <code>WeakReferences</code> are enqueued as soon as the object to which
they point becomes weakly reachable. This is before finalization or garbage collection has actually happened; in theory
the object could even be &quot;resurrected&quot; by an unorthodox <code>finalize()</code> method, but the <code>WeakReference</code> would remain dead.
<code>PhantomReferences</code> are enqueued only when the object is physically removed from memory, and the <code>get()</code> method always
returns <code>null</code> specifically to prevent you from being able to &quot;resurrect&quot; an almost-dead object.</p>
<p>What good are <code>PhantomReferences</code>? I&#x27;m only aware of two serious cases for them: first, they allow you to determine
exactly when an object was removed from memory. They are in fact the only way to determine that. This isn&#x27;t generally
that useful, but might come in handy in certain very specific circumstances like manipulating large images: if you know
for sure that an image should be garbage collected, you can wait until it actually is before attempting to load the next
image, and therefore make the dreaded <code>OutOfMemoryError</code> less likely.</p>
<p>Second, phantom references avoid a fundamental problem with finalization: <code>finalize()</code> methods can &quot;resurrect&quot; objects
by creating new strong references to them. So what, you say? Well, the problem is that an object which overrides
<code>finalize()</code> must now be determined to be garbage in at least two separate garbage collection cycles in order to be
collected. When the first cycle determines that it is garbage, it becomes eligible for finalization. Because of the
(slim, but unfortunately real) possibility that the object was &quot;resurrected&quot; during finalization, the garbage collector
has to run again before the object can actually be removed. And because finalization might not have happened in a timely
fashion, an arbitrary number of garbage collection cycles might have happened while the object was waiting for
finalization. This can mean serious delays in actually cleaning up garbage objects, and is why you can get
<code>OutOfMemoryErrors</code> even when most of the heap is garbage.</p>
<p>With phantom reference, this situation is impossible -- when a <code>PhantomReference</code> is enqueued, there is absolutely no
way to get a pointer to the now-dead object (which is good, because it isn&#x27;t in memory any longer). Because
<code>PhantomReference</code> cannot be used to resurrect an object, the object can be instantly cleaned up during the first
garbage collection cycle in which it is found to be phantomly reachable. You can then dispose whatever resources you
need to at your convenience.</p>
<p>Arguably, the <code>finalize()</code> method should never have been provided in the first place. phantom references are definitely
safer and more efficient to use, and eliminating <code>finalize()</code> would have made parts of the VM considerably simpler. But,
they&#x27;re also more work to implement, so I confess to still using <code>finalize()</code> most of the time. The good news is that at
least you have a choice.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_oeFh"><div class="col"><b>Tags:</b><ul class="tags_Q1w9 padding--none margin-left--sm"><li class="tag_pe7_"><a class="tag_jhT7 tagRegular_pZRu" href="/blog/tags/java">Java</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/QubitPi/chatbot-ws/tree/master/docs/blog/2021-12-30-java-weak-reference.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Hgua" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/defensive-copy"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Defensive Copy</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/querydsl"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Querydsl - A Type-Safe Query Writer for Java</div></a></nav></main><div class="col col--2"><div class="tableOfContents_Bpof thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#strong-references" class="table-of-contents__link toc-highlight">Strong References</a></li><li><a href="#when-strong-references-are-too-strong" class="table-of-contents__link toc-highlight">When Strong References are Too Strong</a></li><li><a href="#weak-references" class="table-of-contents__link toc-highlight">Weak References</a></li><li><a href="#reference-queues" class="table-of-contents__link toc-highlight">Reference Queues</a></li><li><a href="#different-degrees-of-weakness" class="table-of-contents__link toc-highlight">Different Degrees of Weakness</a></li><li><a href="#soft-references" class="table-of-contents__link toc-highlight">Soft References</a></li><li><a href="#phantom-references" class="table-of-contents__link toc-highlight">Phantom References</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/QubitPi/chatbot-ws/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ANth"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/QubitPi/chatbot-ws" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_ANth"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Jiaqi Liu. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>